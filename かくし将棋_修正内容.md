# かくし将棋の駒配置フェーズバグ修正内容

## 問題の概要
元々のゲームは標準的な将棋ゲームでしたが、ユーザーから「かくし将棋」（隠し将棋）の駒配置フェーズで駒の配置可能エリアが表示されないというバグ報告がありました。

## 修正内容

### 1. ゲームフェーズの追加
- `gameState` に `phase` プロパティを追加し、"setup"（駒配置フェーズ）と "game"（通常ゲーム）を区別
- `setupComplete` プロパティを追加し、各プレイヤーの駒配置完了状態を管理

### 2. 初期駒配置の変更
- `initGame()` 関数を修正し、盤上に駒を配置する代わりに、すべての駒を各プレイヤーの手駒に配置
- `initializePiecesInHand()` 関数を新たに追加し、標準的な将棋の駒セット（歩9枚、各駒2枚ずつ、玉・金・銀・桂・香・角・飛）を手駒として配置

### 3. 駒配置可能エリアの実装
- `isValidSetupPlacement()` 関数を追加し、先手は6-8行目、後手は0-2行目に配置可能と定義
- `showValidPlacementAreas()` 関数を追加し、選択された駒の配置可能エリアをハイライト表示

### 4. 駒の選択・配置処理の修正
- `handleCellClick()` 関数にセットアップフェーズの処理を追加
- セットアップフェーズ中は、手駒をクリックすると配置可能エリアが表示される
- 配置可能エリアをクリックすると駒が配置される

### 5. 手駒クリックイベントの修正
- `renderHands()` 関数内の手駒クリックイベントを修正
- セットアップフェーズ中は両プレイヤーの駒を選択可能
- 駒を選択すると `showValidPlacementAreas()` が呼び出される

### 6. セットアップ完了判定
- `checkSetupComplete()` 関数を追加
- 両プレイヤーがすべての駒を配置したら、自動的にゲームフェーズに移行
- ゲームフェーズ移行時にタイマーを開始

### 7. メッセージ表示の改善
- `updateMessage()` 関数を修正し、セットアップフェーズでは残り駒数を表示
- ゲームフェーズでは現在の手番を表示

### 8. 視覚的な改善
- 新しいCSS `.setup-highlight` クラスを追加し、セットアップフェーズでの配置可能エリアを緑色でハイライト表示
- `renderBoard()` 関数を修正し、フェーズに応じて適切なハイライトを表示

## 動作フロー

1. **ゲーム開始**: すべての駒が手駒として配置された状態でセットアップフェーズ開始
2. **駒配置**: プレイヤーは手駒をクリックして選択し、配置可能エリア（緑色ハイライト）をクリックして配置
3. **配置完了**: 両プレイヤーがすべての駒を配置すると、自動的にゲームフェーズに移行
4. **通常ゲーム**: 標準的な将棋ルールでゲーム進行

## 修正されたバグ
- セットアップフェーズでの駒配置可能エリアが正しく表示されるようになりました
- 駒の選択・配置が正常に動作するようになりました
- フェーズ切り替えが正しく動作するようになりました

これらの修正により、かくし将棋の駒配置フェーズが正常に動作し、プレイヤーが駒を配置できるようになりました。